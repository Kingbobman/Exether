namespace = roe_starbrand_events

on_yearly_pulse = {
    events = {
        roe_starbrand_events.0
    }
}

on_monthly_pulse = {
    events = {
        roe_starbrand_events.1
    }
}

roe_starbrand_events.0 = {
    dlc = dlc_roe
    title = "Happy new year!"
    desc = "Determine which starbrand trait can be assigned this year."
    hidden = yes

    # The following
    set_variable = { name = cycle_year value = current_date.year }
    while = {
        limit = { check_variable = { cycle_year >= 12 } }
        subtract_variable = { name = cycle_year value = 12 }
    }
    set_global_variable = { 
        name = roe_starbrand_cycle_year 
        value = cycle_year 
    }
}

roe_starbrand_events.1 = {
    dlc = dlc_roe
    type = character_event
    title = "Assign Star Brand"
    desc = "Assign starbrand traits based on birth month."
    hidden = yes

    trigger = {
        age >= 0
        any_starbrand_trait = no    # Ensure the trait is only assigned once
    }

    immediate = {
        if = {
            limit = { check_global_variable = { name = roe_starbrand_cycle_year value = 0 } }
            limit = { birth_date >= 1.1.1 birth_date < 1.2.1 }
            add_trait = starbrand_beholder
        }
        if = {
            limit = { check_global_variable = { name = roe_starbrand_cycle_year value = 1 } }
            limit = { birth_date >= 1.2.1 birth_date < 1.3.1 }
            add_trait = starbrand_golem
        }
        if = {
            limit = { check_global_variable = { name = roe_starbrand_cycle_year value = 2 } }
            limit = { birth_date >= 1.3.1 birth_date < 1.4.1 }
            add_trait = starbrand_sphinx
        }
        if = {
            limit = { check_global_variable = { name = roe_starbrand_cycle_year value = 3 } }
            limit = { birth_date >= 1.4.1 birth_date < 1.5.1 }
            add_trait = starbrand_fey
        }
        if = {
            limit = { check_global_variable = { name = roe_starbrand_cycle_year value = 4 } }
            limit = { birth_date >= 1.5.1 birth_date < 1.6.1 }
            add_trait = starbrand_phoenix
        }
        if = {
            limit = { check_global_variable = { name = roe_starbrand_cycle_year value = 5 } }
            limit = { birth_date >= 1.6.1 birth_date < 1.7.1 }
            add_trait = starbrand_fiend
        }
        if = {
            limit = { check_global_variable = { name = roe_starbrand_cycle_year value = 6 } }
            limit = { birth_date >= 1.7.1 birth_date < 1.8.1 }
            add_trait = starbrand_modron
        }
        if = {
            limit = { check_global_variable = { name = roe_starbrand_cycle_year value = 7 } }
            limit = { birth_date >= 1.8.1 birth_date < 1.9.1 }
            add_trait = starbrand_kraken
        }
        if = {
            limit = { check_global_variable = { name = roe_starbrand_cycle_year value = 8 } }
            limit = { birth_date >= 1.9.1 birth_date < 1.10.1 }
            add_trait = starbrand_djinn
        }
        if = {
            limit = { check_global_variable = { name = roe_starbrand_cycle_year value = 9 } }
            limit = { birth_date >= 1.10.1 birth_date < 1.11.1 }
            add_trait = starbrand_unicorn
        }
        if = {
            limit = { check_global_variable = { name = roe_starbrand_cycle_year value = 10 } }
            limit = { birth_date >= 1.11.1 birth_date < 1.12.1 }
            add_trait = starbrand_storm_giant
        }
        if = {
            limit = { check_global_variable = { name = roe_starbrand_cycle_year value = 11 } }
            limit = { birth_date >= 1.12.1 }
            add_trait = starbrand_valkyrie
        }
    }
}